- name: rvm installed check
  stat: path=/home/{{ rails_user }}/.rvm/scripts/rvm
  register: rvm_installed
  become: yes
  become_user: "{{ rails_user }}"
  when: rails_user is defined

- name: setup rvm
  shell: "curl -sSL https://get.rvm.io | bash -s stable"
  become: yes
  become_user: "{{ rails_user }}"
  args:
    creates: "/home/{{ rails_user }}/.rvm/scripts/rvm"
  when: rvm_installed.stat.exists == false and rails_user is defined
